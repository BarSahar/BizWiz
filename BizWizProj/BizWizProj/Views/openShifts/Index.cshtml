<script src="@Url.Content("~/Scripts/DayPilot/daypilot-all.min.js")" type="text/javascript"></script>
<br />
<br />
<br />
<br />

<div id="dp">
    @{
        if (((BizWizProj.Models.BizUser)Session["user"]).EmployeeType == BizWizProj.Models.EmployeeType.Manager || ((BizWizProj.Models.BizUser)Session["user"]).EmployeeType == BizWizProj.Models.EmployeeType.SuperShiftManager)
        {
            @Html.DayPilotCalendar("dp", new DayPilot.Web.Mvc.DayPilotCalendarConfig
            {
            BackendUrl = Url.Action("Backend", "OpenShifts"),
            ViewType = DayPilot.Web.Mvc.Enums.Calendar.ViewType.Week,
            TimeFormat = DayPilot.Web.Mvc.Enums.TimeFormat.Clock24Hours,
            EventClickHandling = DayPilot.Web.Mvc.Events.Calendar.EventClickHandlingType.JavaScript,
            EventClickJavaScript = "EditShifts(e)",
        })
        }
        else
        {
            @Html.DayPilotCalendar("dp", new DayPilot.Web.Mvc.DayPilotCalendarConfig
            {
            BackendUrl = Url.Action("Backend", "OpenShifts"),
            ViewType = DayPilot.Web.Mvc.Enums.Calendar.ViewType.Week,
            TimeFormat = DayPilot.Web.Mvc.Enums.TimeFormat.Clock24Hours,
        })
        }
    }

</div>
<br />
@using (Html.BeginForm("OpenToClose", "OpenShifts"))
{
    BizWizProj.Models.EmployeeType currentType = (Session["user"] as BizWizProj.Models.BizUser).EmployeeType;
    if (currentType == BizWizProj.Models.EmployeeType.Manager || currentType == BizWizProj.Models.EmployeeType.SuperShiftManager)
    { 
        <input type="submit" value="Close Shift" class="btn btn-default" />
    }
}

<script type="text/javascript">
    dp.commandCallBack('nextWeek'); //Setting the Shift in progress to always be in next Week
    dp.contextMenu = new DayPilot.Menu({
        items: [
            {
                text: "Want", onclick: function (args) {
                    Post(this.source.value(), 1)
                    this.source.data.backColor = "green";
                    dp.events.update(this.source);
                }
            },
            { text: "-" },
            {
                text: "Don't Care", onclick: function (args) {
                    this.source.data.backColor = "blue";
                    Post(this.source.value(), 2)
                    dp.events.update(this.source);
                }
            },
            { text: "-" },
            {
                text: "Don't Want", onclick: function (args) {
                    this.source.data.backColor = "red";
                    Post(this.source.value(), 3)
                    dp.events.update(this.source);
                }
            },
            {
                text: "Refresh", onclick: function (args) {
                    dp.events.update(this.source);
                }
            },
        ]
    });

    function Post(shiftID, pref) {
        $.post("OpenShifts/SendShift",
        {
            shiftID: shiftID,
            preference: pref
        })
    }

    function EditShifts(e) {
        var m = new DayPilot.Modal();
        m.closed = function () {
            dp.commandCallBack('refresh');
            location.reload();
        };
        m.showUrl('@Url.Action("EditShift", "OpenShifts")?ShiftID=' + e.id());
        }
</script>